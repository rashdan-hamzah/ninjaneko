<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Consulting Problem Solver</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark">
  <meta name="theme-color" content="#0e0f13" />
  <style>
    /* =========================================================================
       Apple-inspired, ultra-smooth single-file UI
       Focus: CSS polish, glassmorphism, motion, micro-interactions
       ========================================================================= */

    :root {
      /* Surfaces */
      --bg-0: #0e0f13;
      --bg-1: #12141a;
      --bg-2: #171a21;
      --panel: rgba(255, 255, 255, 0.62);
      --panel-strong: rgba(255, 255, 255, 0.82);
      --hairline: rgba(10, 16, 26, 0.08);
      --stroke: rgba(10, 16, 26, 0.12);

      /* Text */
      --text: #0b0c10;
      --text-weak: rgba(11, 12, 16, 0.62);
      --text-inv: #ffffff;

      /* Accents */
      --accent: #7aa8ff;
      --accent-2: #9b8cff;
      --accent-3: #68e2ff;

      /* Radii */
      --r-lg: 22px;
      --r-md: 16px;
      --r-sm: 12px;
      --r-xs: 10px;

      /* Shadows */
      --sh-1: 0 12px 30px rgba(8, 10, 18, 0.14), 0 4px 14px rgba(8, 10, 18, 0.10);
      --sh-2: 0 20px 55px rgba(8, 10, 18, 0.18), 0 6px 18px rgba(8, 10, 18, 0.10);

      /* Motion */
      --ease: cubic-bezier(.2, .6, .2, 1);
      --spring: cubic-bezier(.18, .89, .21, 1.11);

      /* Backdrop */
      --blur: 22px;
      --sat: 125%;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --panel: rgba(20, 24, 32, 0.56);
        --panel-strong: rgba(28, 32, 42, 0.82);
        --hairline: rgba(255, 255, 255, 0.06);
        --stroke: rgba(255, 255, 255, 0.12);
        --text: #e7e9ee;
        --text-weak: rgba(231, 233, 238, 0.68);
      }
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI",
        Roboto, "Helvetica Neue", Arial, system-ui, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1200px 1200px at 20% 0%, #203248 0%, transparent 60%),
        radial-gradient(900px 900px at 80% 10%, #14263a 0%, transparent 60%),
        linear-gradient(180deg, var(--bg-0) 0%, var(--bg-1) 100%);
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
    }
    ::selection{ background: color-mix(in oklab, var(--accent) 26%, transparent); }

    /* Ambient glow orbs (subtle) */
    .orb {
      position: fixed;
      inset: -10vh -20vw auto auto;
      width: 70vw; height: 70vh;
      pointer-events: none;
      filter: blur(52px) saturate(120%);
      opacity: .25;
      mix-blend-mode: screen;
      background:
        radial-gradient(closest-side at 30% 40%, rgba(140,115,255,.32), transparent 65%),
        radial-gradient(closest-side at 70% 60%, rgba(72,165,255,.28), transparent 60%),
        radial-gradient(closest-side at 50% 80%, rgba(60,220,255,.20), transparent 60%);
      animation: orbFloat 16s var(--ease) infinite alternate;
      z-index: 0;
    }
    .orb.orb-b {
      inset: auto auto -25vh -20vw;
      width: 60vw; height: 60vh;
      opacity: .22;
      transform: translate3d(0,0,0) scale(1.05);
      animation: orbFloatB 18s var(--ease) infinite alternate;
    }
    @keyframes orbFloat { 0% { transform: translate3d(-2%, -1%, 0) } 100% { transform: translate3d(2%, 3%, 0) } }
    @keyframes orbFloatB { 0% { transform: translate3d(1%, -2%, 0) } 100% { transform: translate3d(-2%, 2%, 0) } }

    /* Layout */
    .wrap {
      position: relative;
      z-index: 1;
      display: grid;
      grid-template-rows: auto 1fr auto;
      min-height: 100dvh;
    }

    /* Top bar */
    .topbar {
      position: sticky;
      top: 0;
      margin: 16px auto 0;
      max-width: 1080px;
      width: calc(100% - 32px);
      backdrop-filter: saturate(var(--sat)) blur(var(--blur));
      -webkit-backdrop-filter: saturate(var(--sat)) blur(var(--blur));
      background: linear-gradient(180deg, var(--panel-strong), var(--panel));
      border: 1px solid var(--hairline);
      border-radius: var(--r-lg);
      box-shadow: var(--sh-1);
      overflow: clip;
    }
    .topbar-row {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 14px 16px;
    }
    .brand {
      display: flex; align-items: center; gap: 10px;
    }
    .dot {
      width: 12px; height: 12px; border-radius: 50%;
      background: linear-gradient(180deg, #9db6ff, #7aa8ff);
      box-shadow: 0 4px 10px rgba(122,168,255,.55);
    }
    .title {
      font-weight: 700;
      letter-spacing: .2px;
      background: linear-gradient(90deg, #cfd9ff, #9fb4ff 35%, #a89cff 70%, #8fe6ff);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-size: 15px;
    }

    /* Segmented control */
    .seg {
      margin-left: auto;
      position: relative;
      display: inline-grid;
      grid-auto-flow: column;
      gap: 6px;
      background: rgba(255,255,255,.4);
      border: 1px solid var(--hairline);
      border-radius: 999px;
      padding: 6px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.35);
    }
    @media (prefers-color-scheme: dark) {
      .seg { background: rgba(255,255,255,.06); box-shadow: inset 0 1px 0 rgba(255,255,255,.04); }
    }
    .seg button {
      position: relative;
      appearance: none;
      border: 0;
      background: transparent;
      color: var(--text-weak);
      padding: 10px 14px;
      border-radius: 999px;
      font-weight: 600;
      font-size: 13px;
      letter-spacing: .2px;
      cursor: pointer;
      transition: color .35s var(--ease);
      z-index: 1;
    }
    .seg button.active { color: var(--text); }
    .seg .thumb {
      position: absolute;
      top: 4px; bottom: 4px;
      width: 25%;
      border-radius: 999px;
      background: linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.65));
      box-shadow: 0 8px 20px rgba(10,10,20,.10), inset 0 1px 0 rgba(255,255,255,.8);
      border: 1px solid var(--stroke);
      transition: transform .5s var(--spring), width .25s var(--ease), left .5s var(--spring);
      will-change: transform, left;
      left: 4px; /* anchor */
    }
    @media (prefers-color-scheme: dark) {
      .seg .thumb {
        background: linear-gradient(180deg, rgba(40,44,56,.95), rgba(34,38,48,.85));
        border-color: rgba(255,255,255,.08);
      }
    }

    /* Main card */
    .main {
      margin: 26px auto;
      max-width: 980px;
      width: calc(100% - 32px);
      display: grid;
      gap: 18px;
      grid-template-columns: 1fr;
    }
    .card {
      position: relative;
      background: linear-gradient(180deg, var(--panel-strong), var(--panel));
      border: 1px solid var(--hairline);
      border-radius: var(--r-lg);
      box-shadow: var(--sh-2);
      backdrop-filter: saturate(var(--sat)) blur(var(--blur));
      -webkit-backdrop-filter: saturate(var(--sat)) blur(var(--blur));
      overflow: clip;
      transform: translateZ(0);
    }
    .card::before {
      content: "";
      position: absolute; inset: -1px;
      border-radius: calc(var(--r-lg) + 1px);
      pointer-events: none;
      background:
        linear-gradient(180deg, rgba(255,255,255,.4), rgba(255,255,255,0) 40%),
        linear-gradient(0deg, rgba(255,255,255,.25), rgba(255,255,255,0) 60%);
      mix-blend-mode: overlay;
    }
    .card::after {
      content: "";
      position: absolute;
      top: -60%; left: -20%;
      width: 60%; height: 220%;
      transform: rotate(12deg);
      background: linear-gradient(90deg, rgba(255,255,255,.12), rgba(255,255,255,0), rgba(255,255,255,.14));
      filter: blur(14px);
      opacity: .35;
      pointer-events: none;
      animation: sheen 9s var(--ease) infinite;
    }
    @keyframes sheen {
      0% { transform: translateX(-10%) rotate(12deg); opacity: .15; }
      50% { transform: translateX(40%) rotate(12deg); opacity: .35; }
      100% { transform: translateX(90%) rotate(12deg); opacity: .12; }
    }

    .card-head {
      display: flex; align-items: center; justify-content: space-between;
      padding: 20px 22px 8px 22px;
    }
    .headline {
      font-size: 14px;
      font-weight: 700;
      letter-spacing: .22px;
      color: var(--text-weak);
      text-transform: uppercase;
    }
    .controls {
      display: flex; gap: 10px; align-items: center;
      position: relative;
    }

    .card-body {
      padding: 10px 22px 22px 22px;
    }

    /* Output window */
    .output {
      position: relative;
      border-radius: var(--r-md);
      border: 1px solid var(--hairline);
      background:
        linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.6));
      box-shadow: inset 0 1px 0 rgba(255,255,255,.5);
      overflow: clip;
      padding: 20px 20px;
      transition: transform .5s var(--spring), box-shadow .5s var(--ease);
      will-change: transform, box-shadow;
    }
    @media (prefers-color-scheme: dark) {
      .output {
        background:
          linear-gradient(180deg, rgba(34,38,48,.92), rgba(30,34,44,.82));
        box-shadow: inset 0 1px 0 rgba(255,255,255,.04);
      }
    }
    .output:hover { transform: translateY(-1px); box-shadow: inset 0 1px 0 rgba(255,255,255,.55), 0 8px 28px rgba(8,10,18,.12); }

    .output-inner {
      position: relative;
      display: grid;
      align-content: center;
      gap: 10px;
    }

    .prompt-title {
      font-size: clamp(20px, 2.6vw, 26px);
      font-weight: 800;
      line-height: 1.15;
      letter-spacing: .2px;
      color: var(--text);
      text-wrap: balance;
      transform-origin: 50% 100%;
    }
    .prompt-sub {
      color: var(--text-weak);
      font-size: 14px;
    }
    .pillrow { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 6px; }
    .pill {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 8px 12px;
      background: linear-gradient(180deg, rgba(255,255,255,.78), rgba(255,255,255,.6));
      border: 1px solid var(--hairline);
      border-radius: 999px;
      font-size: 12px; font-weight: 700; color: var(--text-weak);
      letter-spacing: .2px;
      box-shadow: 0 4px 12px rgba(8,10,18,.06), inset 0 1px 0 rgba(255,255,255,.4);
    }
    @media (prefers-color-scheme: dark) {
      .pill { background: linear-gradient(180deg, rgba(42,46,58,.9), rgba(34,38,48,.8)); box-shadow: inset 0 1px 0 rgba(255,255,255,.04); }
    }
    .dot-mini {
      width: 8px; height: 8px; border-radius: 50%;
      background: linear-gradient(180deg, var(--accent), var(--accent-3));
      box-shadow: 0 4px 10px rgba(122,168,255,.5);
    }

    /* Framework list styling */
    .fw-list { display: grid; gap: 8px; margin-top: 8px; }
    .fw-item {
      display: grid; grid-template-columns: 18px 1fr;
      gap: 10px; align-items: start;
      color: var(--text);
      font-size: 15px;
    }
    .fw-bullet {
      width: 18px; height: 18px; border-radius: 50%;
      display: inline-grid; place-content: center;
      background: linear-gradient(180deg, #cfe0ff, #a8c1ff);
      color: #0e1a33; font-weight: 900; font-size: 11px;
      box-shadow: 0 6px 14px rgba(122,168,255,.35), inset 0 1px 0 rgba(255,255,255,.8);
      border: 1px solid rgba(10,16,26,.16);
    }
    @media (prefers-color-scheme: dark) {
      .fw-bullet { background: linear-gradient(180deg, #3a4a6d, #2f405f); color: #e9f1ff; border-color: rgba(255,255,255,.1); }
    }

    /* Actions */
    .actions {
      display: flex; flex-wrap: wrap;
      gap: 12px; margin-top: 16px;
    }
    .btn {
      position: relative;
      appearance: none;
      border: 0;
      border-radius: 14px;
      padding: 14px 18px;
      font-weight: 800;
      font-size: 14px;
      letter-spacing: .3px;
      cursor: pointer;
      transition: transform .5s var(--spring), box-shadow .5s var(--ease), background .3s var(--ease), color .3s var(--ease);
      will-change: transform, box-shadow;
      outline: none;
    }
    .btn-primary {
      color: #0b1020;
      background:
        linear-gradient(180deg, #cfe0ff, #a8c1ff 60%, #9fc4ff);
      border: 1px solid rgba(10,16,26,.16);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.9),
        0 12px 28px rgba(122,168,255,.35),
        0 4px 10px rgba(10,16,26,.10);
    }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: inset 0 1px 0 rgba(255,255,255,.95), 0 16px 34px rgba(122,168,255,.40), 0 6px 14px rgba(10,16,26,.12); }
    .btn-primary:active { transform: translateY(0); transition: transform .08s ease; }

    .btn-ghost {
      color: var(--text);
      background: linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.7));
      border: 1px solid var(--hairline);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.7), 0 6px 18px rgba(8,10,18,.10);
    }
    .btn-ghost:hover { transform: translateY(-1px); }
    .btn-ghost:active { transform: translateY(0); transition: transform .08s ease; }

    /* Ripple effect */
    .btn .ripple {
      position: absolute;
      border-radius: 999px;
      transform: translate(-50%, -50%);
      pointer-events: none;
      width: 8px; height: 8px;
      background: radial-gradient(circle at center, rgba(255,255,255,.8), rgba(255,255,255,0) 70%);
      animation: ripple .7s var(--ease);
      opacity: .7;
    }
    @keyframes ripple {
      from { transform: translate(-50%, -50%) scale(.5); opacity: .6; }
      to { transform: translate(-50%, -50%) scale(18); opacity: 0; }
    }

    /* Tooltip */
    .tip {
      position: absolute;
      top: -40px; right: 10px;
      background: linear-gradient(180deg, rgba(255,255,255,.98), rgba(255,255,255,.86));
      color: #0b0c10;
      padding: 6px 10px;
      border-radius: 9px;
      font-size: 12px; font-weight: 700; letter-spacing: .2px;
      border: 1px solid var(--hairline);
      box-shadow: 0 10px 24px rgba(8,10,18,.14), inset 0 1px 0 rgba(255,255,255,.85);
      transform-origin: 100% 100%;
      transform: translateY(6px) scale(.92);
      opacity: 0; pointer-events: none;
      transition: transform .35s var(--spring), opacity .35s var(--ease);
    }
    .tip.show { opacity: 1; transform: translateY(0) scale(1); }

    /* History */
    .history {
      display: grid; gap: 10px;
      grid-template-columns: 1fr;
    }
    .row-scroll {
      display: grid; grid-auto-flow: column; grid-auto-columns: max-content;
      gap: 10px; padding-bottom: 2px;
      overflow-x: auto; overscroll-behavior-x: contain;
      scrollbar-width: thin;
      scroll-snap-type: x proximity;
    }
    .chip {
      scroll-snap-align: start;
      white-space: nowrap;
      max-width: 360px;
      text-overflow: ellipsis;
      overflow: hidden;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--hairline);
      background: linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.7));
      color: var(--text-weak);
      font-size: 13px; font-weight: 700;
      cursor: pointer;
      transition: transform .4s var(--spring), color .3s var(--ease));
      box-shadow: inset 0 1px 0 rgba(255,255,255,.65), 0 8px 18px rgba(8,10,18,.08);
    }
    .chip:hover { transform: translateY(-2px); color: var(--text); }
    @media (prefers-color-scheme: dark) {
      .chip { background: linear-gradient(180deg, rgba(40,44,56,.92), rgba(34,38,48,.82)); box-shadow: inset 0 1px 0 rgba(255,255,255,.04); }
    }

    /* Swap animations for output content */
    .swap {
      position: relative;
      min-height: 120px;
    }
    .pane {
      position: absolute; inset: 0;
      display: grid; align-content: center; gap: 10px;
      opacity: 0; transform: translateY(10px) scale(.98);
      transition: opacity .55s var(--ease), transform .55s var(--spring), filter .55s var(--ease);
      filter: blur(6px);
      will-change: transform, opacity, filter;
    }
    .pane.show {
      opacity: 1; transform: translateY(0) scale(1);
      filter: blur(0);
    }
    .pane.exit {
      opacity: 0; transform: translateY(-10px) scale(.995);
      filter: blur(6px);
    }

    /* Answer region (added) */
    .answer-controls {
      display: flex; align-items: center; gap: 10px;
      margin-top: 8px;
    }
    .btn-toggle {
      display: inline-flex; align-items: center; gap: 8px;
    }
    .chev {
      width: 10px; height: 10px;
      border-right: 2px solid currentColor;
      border-bottom: 2px solid currentColor;
      transform: rotate(-45deg) translateY(-1px);
      transition: transform .35s var(--spring);
      opacity: .9;
    }
    .btn-toggle[aria-expanded="true"] .chev {
      transform: rotate(45deg) translateY(1px);
    }

    .answer-wrap {
      overflow: clip;
      height: 0;
      transition: height .55s var(--spring), opacity .45s var(--ease), transform .45s var(--ease);
      opacity: 0;
      transform: translateY(-4px);
    }
    .answer-wrap.open {
      opacity: 1;
      transform: translateY(0);
    }
    .answer-card {
      margin-top: 10px;
      border-radius: var(--r-md);
      border: 1px solid var(--hairline);
      background:
        linear-gradient(180deg, rgba(255,255,255,.78), rgba(255,255,255,.64));
      box-shadow: inset 0 1px 0 rgba(255,255,255,.5);
      padding: 16px 16px;
    }
    @media (prefers-color-scheme: dark) {
      .answer-card {
        background: linear-gradient(180deg, rgba(42,46,58,.92), rgba(34,38,48,.86));
        box-shadow: inset 0 1px 0 rgba(255,255,255,.04);
      }
    }
    .answer-title {
      font-size: 13px;
      font-weight: 800;
      letter-spacing: .22px;
      color: var(--text-weak);
      text-transform: uppercase;
      margin-bottom: 8px;
    }
    .answer-content {
      font-size: 14px;
      line-height: 1.5;
      color: var(--text);
    }
    .answer-content ul { margin: 8px 0 0 18px; }
    .answer-content li { margin: 4px 0; }

    /* Footer */
    .foot {
      margin: 20px auto 30px;
      max-width: 980px; width: calc(100% - 32px);
      color: var(--text-weak);
      font-size: 12px; letter-spacing: .2px;
      text-align: center;
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .orb, .orb-b, .card::after { animation: none !important; }
      .btn, .seg .thumb, .pane, .answer-wrap { transition-duration: .01ms !important; }
    }
  </style>
</head>
<body>
  <div class="orb"></div>
  <div class="orb orb-b"></div>

  <div class="wrap">
    <!-- Topbar -->
    <div class="topbar" role="navigation" aria-label="Mode selector">
      <div class="topbar-row">
        <div class="brand">
          <div class="dot" aria-hidden="true"></div>
          <div class="title">Consulting Problem Solver</div>
        </div>

        <!-- Segmented control -->
        <div class="seg" id="seg" role="tablist" aria-label="Modes">
          <div class="thumb" id="segThumb" aria-hidden="true"></div>
          <button class="active" role="tab" aria-selected="true" data-mode="case">Case Prompt</button>
          <button role="tab" aria-selected="false" data-mode="framework">Framework</button>
          <button role="tab" aria-selected="false" data-mode="estimation">Estimation</button>
          <button role="tab" aria-selected="false" data-mode="brainstorm">Brainstorm</button>
        </div>
      </div>
    </div>

    <!-- Main -->
    <main class="main" role="main">
      <!-- Output card -->
      <section class="card" aria-live="polite">
        <header class="card-head">
          <div class="headline" id="headline">Case Prompt</div>
          <div class="controls">
            <button class="btn btn-ghost" id="copyBtn" aria-label="Copy to clipboard">Copy</button>
            <div class="tip" id="copyTip">Copied!</div>
          </div>
        </header>

        <div class="card-body">
          <div class="output">
            <div class="output-inner">
              <div class="pillrow" id="tagRow">
                <span class="pill"><span class="dot-mini"></span> Strategy</span>
                <span class="pill"><span class="dot-mini"></span> MECE</span>
                <span class="pill"><span class="dot-mini"></span> Client-ready</span>
              </div>

              <!-- Swappable content panes -->
              <div class="swap" id="swap">
                <div class="pane show" id="paneA"></div>
                <div class="pane" id="paneB"></div>
              </div>

              <!-- Answer: toggle + panel -->
              <div class="answer-controls">
                <button class="btn btn-ghost btn-toggle" id="ansToggle" aria-expanded="false" aria-controls="answerWrap">
                  <span class="chev" aria-hidden="true"></span>
                  Show Sample Answer
                </button>
              </div>
              <div class="answer-wrap" id="answerWrap" role="region" aria-label="Sample Answer">
                <div class="answer-card">
                  <div class="answer-title">Sample Answer</div>
                  <div class="answer-content" id="answerContent">
                    <!-- filled by JS -->
                  </div>
                </div>
              </div>

              <div class="actions">
                <button class="btn btn-primary" id="genBtn" aria-label="Generate">Generate</button>
                <button class="btn btn-ghost" id="shuffleBtn" aria-label="Generate variant">Variant</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- History card -->
      <section class="card">
        <header class="card-head">
          <div class="headline">History</div>
        </header>
        <div class="card-body">
          <div class="history">
            <div class="row-scroll" id="history"></div>
          </div>
        </div>
      </section>
    </main>

    <footer class="foot">
      Tip: Space = Generate • Cmd/Ctrl+C = Copy • A = Toggle Answer • 1/2/3/4 = Switch modes
    </footer>
  </div>

  <script>
    // =========================================================================
    // Content pools (original rich generator, preserved)
    // =========================================================================
    const CASE_PROMPTS = [
      "A premium coffee chain faces declining same-store sales. How would you diagnose and reverse the trend?",
      "A medical devices firm considers entering Southeast Asia. Outline a market entry strategy and key risks.",
      "A B2B SaaS startup has strong adoption but rising churn. Build a plan to improve retention by 30%.",
      "A national grocer is losing market share to discounters. What are the growth levers and how to prioritize?",
      "A mobility app wants profitability in 12 months. Where do you focus: pricing, costs, or product mix?",
      "An industrial manufacturer sees margin compression. Dissect COGS and propose cost-out opportunities.",
      "A luxury apparel brand wants to launch resale. Evaluate cannibalization, economics, and operating model.",
      "A telecom provider considers bundling streaming. Size the prize and define partnership structure.",
      "A fintech wallet plans credit offerings. Assess risk, unit economics, and regulatory implications.",
      "A logistics firm targets last-mile expansion. Design the network, SLAs, and capital-light options."
    ];

    const FRAMEWORKS = [
      { title: "Profitability Tree", items: ["Revenue = Price × Volume", "COGS + Opex breakdown", "Mix, discounting, leakage", "Capacity, utilization, productivity", "Quick wins vs. structural plays"], answer:
        `<ul>
          <li><strong>When to use:</strong> Diagnose declining margins or prioritize levers.</li>
          <li><strong>How:</strong> Split into Revenue vs. Cost, then decompose drivers (price, volume, mix; fixed vs. variable).</li>
          <li><strong>Example:</strong> Retail chain: focus on discount leakage (-150 bps) and labor productivity (+80 bps).</li>
        </ul>` },
      { title: "Market Entry", items: ["TAM-SAM-SOM", "Attractiveness (growth, margins)", "Competitive intensity", "Routes-to-market, partners", "Entry mode: build, buy, ally"], answer:
        `<ul>
          <li><strong>Approach:</strong> Size market, score attractiveness, shortlist countries.</li>
          <li><strong>Entry mode:</strong> Partner where regulation is tight; build where capability edge exists.</li>
          <li><strong>Example:</strong> SEA med devices: distributor-led entry, phase-1 in SG/MY, parallel reg filings.</li>
        </ul>` },
      { title: "3C + STP + 4P", items: ["Customer segments & needs", "Company capabilities", "Competition moats", "Segment-Target-Position", "Product, Price, Place, Promotion"], answer:
        `<ul>
          <li><strong>Why:</strong> Holistic go-to-market from insight to execution.</li>
          <li><strong>Output:</strong> Clear ICP, differentiated position, pricing guardrails, channels plan.</li>
          <li><strong>Example:</strong> SaaS: target 20–200 FTE firms, position on ease-of-use, land via PLG + partner resellers.</li>
        </ul>` },
      { title: "Value Chain", items: ["Inbound logistics", "Operations", "Outbound logistics", "Marketing & sales", "Service (post-sale)"], answer:
        `<ul>
          <li><strong>Use:</strong> Find bottlenecks, cost leaks, or experience gaps end-to-end.</li>
          <li><strong>Example:</strong> Manufacturing: inbound (supplier terms), ops (OEE), outbound (route density), service (NPS).</li>
        </ul>` },
      { title: "Porter’s Five Forces", items: ["Threat of entrants", "Bargaining power of suppliers", "Bargaining power of buyers", "Threat of substitutes", "Rivalry among incumbents"], answer:
        `<ul>
          <li><strong>Goal:</strong> Assess structural profitability and risks.</li>
          <li><strong>Tip:</strong> Quantify with proxies (HHI, churn, price dispersion) for rigor.</li>
        </ul>` },
      { title: "Pricing Architecture", items: ["Willingness-to-pay bands", "Good/Better/Best packaging", "Discount governance", "Elasticity experiments", "Monetize add-ons"], answer:
        `<ul>
          <li><strong>Stack:</strong> WTP research → packaging → rules → A/B tests → dashboards.</li>
          <li><strong>Example:</strong> Introduce Good/Better/Best; tighten discount policy; add paid priority support.</li>
        </ul>` },
      { title: "Cost Transformation", items: ["Should-cost baselining", "Zero-based budgeting", "Make vs. buy", "Automation opportunities", "Supplier negotiations"], answer:
        `<ul>
          <li><strong>Playbook:</strong> 13-week sprints; governance; quantified case per lever.</li>
          <li><strong>Outcome:</strong> 8–12% opex, 3–6% COGS reduction typically.</li>
        </ul>` }
    ];

    const ESTIMATIONS = [
      "How many umbrellas are sold annually in London? Structure drivers: population × rainy days × purchase rate.",
      "Estimate annual revenue of airport Wi‑Fi in Europe. Consider traveler volumes, attach rates, ARPU.",
      "Market size for premium pet food in the US. Segment by households, pet ownership, spend per pet.",
      "How many EV charging sessions per day in NYC? Vehicles in circulation × utilization × session length.",
      "Size the ‘ghost kitchen’ market in a tier‑1 city. Demand density, order frequencies, AOV."
    ];

    const BRAINSTORMS = [
      "10 ways to reduce churn in a SaaS product without cutting price.",
      "Creative growth loops for a marketplace with cold-start problems.",
      "Zero-capex ideas to increase retail basket size.",
      "Cross-sell plays for a bank launching BNPL.",
      "Boosting referral rates for a mobile subscription app."
    ];

    // Sample answers mapped to prompts (added)
    const CASE_ANSWERS = {
      "A premium coffee chain faces declining same-store sales. How would you diagnose and reverse the trend?":
        `<ul>
          <li><strong>Diagnose:</strong> Decompose SSS into traffic vs. ticket; cohort trends; daypart; store clusters.</li>
          <li><strong>Levers:</strong> Menu mix (attach breakfast), pricing A/B, queue time reduction, localized promos.</li>
          <li><strong>Pilot:</strong> 20 stores, 8-week test; target +4–6% SSS; scale with playbooks.</li>
        </ul>`,
      "A medical devices firm considers entering Southeast Asia. Outline a market entry strategy and key risks.":
        `<ul>
          <li><strong>Prioritize markets:</strong> SG/MY/TH first (reg ease, private spend growth).</li>
          <li><strong>Mode:</strong> Distributor-led; SLAs on coverage, training, after‑sales.</li>
          <li><strong>Risks:</strong> Registration delays, reimbursement variability; mitigate via dual distributors.</li>
        </ul>`,
      "A B2B SaaS startup has strong adoption but rising churn. Build a plan to improve retention by 30%.":
        `<ul>
          <li><strong>Root causes:</strong> Onboarding gaps, value not realized, support latency.</li>
          <li><strong>Plays:</strong> Guided onboarding, health scoring, success check‑ins at D30/60/90.</li>
          <li><strong>Economics:</strong> Improve NRR +8–12 pts; target payback < 12 months.</li>
        </ul>`,
      "A national grocer is losing market share to discounters. What are the growth levers and how to prioritize?":
        `<ul>
          <li><strong>Compete:</strong> KVIs price match, own‑label penetration +5 pts, fresh quality uplift.</li>
          <li><strong>Omni:</strong> Pickup density, app UX, personalized offers.</li>
          <li><strong>Capex-light:</strong> Space resets, shrink reduction; stage by ROI.</li>
        </ul>`,
      "A mobility app wants profitability in 12 months. Where do you focus: pricing, costs, or product mix?":
        `<ul>
          <li><strong>Monetize:</strong> Peak pricing, subscriptions; reduce incentives leakage.</li>
          <li><strong>Cost:</strong> Support automation, fraud controls; marketing efficiency.</li>
          <li><strong>Mix:</strong> High-margin categories (XL/Delivery); geographic pruning.</li>
        </ul>`,
      "An industrial manufacturer sees margin compression. Dissect COGS and propose cost-out opportunities.":
        `<ul>
          <li><strong>Should-cost:</strong> Material indexation; VA/VE redesign; supplier consolidation.</li>
          <li><strong>Ops:</strong> OEE +5 pts, scrap -30%, setup reduction; energy contracts.</li>
          <li><strong>Outcome:</strong> 250–400 bps margin recovery in 12–18 months.</li>
        </ul>`,
      "A luxury apparel brand wants to launch resale. Evaluate cannibalization, economics, and operating model.":
        `<ul>
          <li><strong>Model:</strong> Consignment marketplace with authentication partners.</li>
          <li><strong>Economics:</strong> Take rate 15–25%; lift first‑party sales via brand halo.</li>
          <li><strong>Risks:</strong> Channel conflict; mitigate with exclusive drops / tiering.</li>
        </ul>`,
      "A telecom provider considers bundling streaming. Size the prize and define partnership structure.":
        `<ul>
          <li><strong>Prize:</strong> ARPU +$3–$5; churn -70–120 bps; depends on attach.</li>
          <li><strong>Deal:</strong> Rev share vs. wholesale; co‑marketing KPIs; data rights.</li>
        </ul>`,
      "A fintech wallet plans credit offerings. Assess risk, unit economics, and regulatory implications.":
        `<ul>
          <li><strong>Unit econ:</strong> APR, loss rates, funding cost, servicing; sandbox with thin files.</li>
          <li><strong>Risk:</strong> Alternative data underwriting; staged limits; collections playbook.</li>
        </ul>`,
      "A logistics firm targets last-mile expansion. Design the network, SLAs, and capital-light options.":
        `<ul>
          <li><strong>Network:</strong> Micro‑fulfillment hubs; dynamic routing; density first.</li>
          <li><strong>SLAs:</strong> 95% on‑time; tiered delivery windows; partner couriers to stay asset‑light.</li>
        </ul>`
    };

    const EST_ANSWERS = {
      "How many umbrellas are sold annually in London? Structure drivers: population × rainy days × purchase rate.":
        `<ul>
          <li>Pop ~9M × households ~2.5M; rainy days ~150.</li>
          <li>Purchase rate: 0.6 umbrellas/adult/year (loss/breakage).</li>
          <li><strong>Back‑of‑envelope:</strong> ~5–6M units/yr; sanity check vs. retail scanner data.</li>
        </ul>`,
      "Estimate annual revenue of airport Wi‑Fi in Europe. Consider traveler volumes, attach rates, ARPU.":
        `<ul>
          <li>Passengers ~1B; attach ~3–6% paid; ARPU €4–€6.</li>
          <li><strong>Rev:</strong> 1B × 4% × €5 ≈ €200M; adjust for free tiers, lounge access.</li>
        </ul>`,
      "Market size for premium pet food in the US. Segment by households, pet ownership, spend per pet.":
        `<ul>
          <li>HH ~130M; pet HH ~70M; premium share ~35%.</li>
          <li>Spend/pet ~$400/yr; dogs vs cats mix.</li>
          <li><strong>TAM:</strong> ~$10–12B; triangulate with Nielsen/IRI.</li>
        </ul>`,
      "How many EV charging sessions per day in NYC? Vehicles in circulation × utilization × session length.":
        `<ul>
          <li>EVs ~2–3% of ~2M vehicles; sessions ~0.2/day per EV.</li>
          <li><strong>Sessions:</strong> ~8–12k/day; split L2 vs DCFC utilization.</li>
        </ul>`,
      "Size the ‘ghost kitchen’ market in a tier‑1 city. Demand density, order frequencies, AOV.":
        `<ul>
          <li>Orders/HH/mo × HH × AOV × ghost share.</li>
          <li><strong>Illustrative:</strong> 1.5M HH × 3 × $22 × 12% ≈ $1.2B/y.</li>
        </ul>`
    };

    const BRAIN_ANSWERS = {
      "10 ways to reduce churn in a SaaS product without cutting price.": listify([
        "Strengthen onboarding with in‑app checklists and success metrics.",
        "Trigger lifecycle emails based on usage gaps.",
        "Create customer councils; ship top 3 asks per quarter.",
        "Proactive support for at‑risk health scores.",
        "Annual plans with soft commitments and value add‑ons.",
        "Champion enablement kits to spread adoption.",
        "In‑product nudges to discover sticky features.",
        "Build community and templates gallery.",
        "Office hours with product managers.",
        "Contract renewal playbook with QBRs."
      ]),
      "Creative growth loops for a marketplace with cold-start problems.": listify([
        "Supply‑led seeding with exclusive inventory.",
        "Referral rewards for both sides of the market.",
        "Content loop: UGC reviews fuel SEO → demand.",
        "Embedded widgets partners can add to sites.",
        "Integrations with calendars/CRMs for lock‑in.",
        "Waitlist dynamics with early access perks.",
        "Creator partnerships for viral discovery.",
        "API access to foster ecosystem tools."
      ]),
      "Zero-capex ideas to increase retail basket size.": listify([
        "Personalized bundles at checkout.",
        "End‑cap rotations for high‑margin cross‑sell.",
        "Recipe‑based shopping lists in app.",
        "Digital coupons for complementary items.",
        "Associate prompts via handsets for cross‑sell.",
        "A/B test aisle signage copy for clarity.",
        "Subscription for refillables.",
        "Rundown list reminders before store visit."
      ]),
      "Cross-sell plays for a bank launching BNPL.": listify([
        "Auto‑enroll debit users with pre‑approved limits.",
        "Bundle with credit monitoring and alerts.",
        "Merchant co‑marketing for exclusive offers.",
        "Instant card issuance after on‑time history.",
        "Finance higher‑ticket categories with 0% promos.",
        "Cashback tiers for multi‑product usage."
      ]),
      "Boosting referral rates for a mobile subscription app.": listify([
        "Time‑boxed friend passes with premium features.",
        "Milestone badges unlock referral boosts.",
        "Creators toolkit to share results on socials.",
        "Co‑create challenges users can invite friends to.",
        "Tiered rewards: 1, 3, 5 referrals unlock perks.",
        "In‑app share sheets with tailored copy."
      ])
    };

    function listify(items){
      return `<ul>${items.map(i=>`<li>${i}</li>`).join("")}</ul>`;
    }

    // =========================================================================
    // Elements
    // =========================================================================
    const seg = document.getElementById("seg");
    const segThumb = document.getElementById("segThumb");
    const segButtons = Array.from(seg.querySelectorAll("button"));

    const headline = document.getElementById("headline");
    const tagRow = document.getElementById("tagRow");

    const genBtn = document.getElementById("genBtn");
    const shuffleBtn = document.getElementById("shuffleBtn");
    const copyBtn = document.getElementById("copyBtn");
    const copyTip = document.getElementById("copyTip");

    const swap = document.getElementById("swap");
    const paneA = document.getElementById("paneA");
    const paneB = document.getElementById("paneB");
    const historyRow = document.getElementById("history");

    const ansToggle = document.getElementById("ansToggle");
    const answerWrap = document.getElementById("answerWrap");
    const answerContent = document.getElementById("answerContent");

    // State
    let mode = "case";          // case | framework | estimation | brainstorm
    let activePane = paneA;     // currently visible pane element
    let cacheLast = "";         // last rendered plain text (for copy)
    let lock = false;           // re-entrancy guard
    let answerOpen = false;     // answer panel state

    // =========================================================================
    // Helpers
    // =========================================================================
    function setMode(newMode) {
      mode = newMode;
      segButtons.forEach((b, i) => {
        const isActive = b.dataset.mode === newMode;
        b.classList.toggle("active", isActive);
        b.setAttribute("aria-selected", String(isActive));
        if (isActive) moveThumbTo(i);
      });
      const t = { case: "Case Prompt", framework: "Framework", estimation: "Estimation", brainstorm: "Brainstorm" }[newMode];
      headline.textContent = t;
      renderTags(TAGS[newMode] || []);
      generate(true);
    }

    function moveThumbTo(index) {
      const btn = segButtons[index];
      if (!btn) return;
      const segRect = seg.getBoundingClientRect();
      const btnRect = btn.getBoundingClientRect();
      const left = (btnRect.left - segRect.left) - 2;
      const width = btnRect.width + 4;
      segThumb.style.transform = `translateX(${left}px)`;
      segThumb.style.width = width + "px";
    }

    const TAGS = {
      case: ["Strategy", "MECE", "Client-ready"],
      framework: ["Structured", "Reusable", "Decision-Ready"],
      estimation: ["Assumptions", "Top-Down